import{a as V,b as Y,c as Z}from"./chunk-4FDIPWVB.mjs";import{q as F,t as M}from"./chunk-7QJYTQSU.mjs";import{a as u}from"./chunk-OXO3Z2MF.mjs";import{a as l,c as g,d as m}from"./chunk-3QS3MFWJ.mjs";import{c as L,d as H,e as X,f as z,g as j,h as J,i as Q}from"./chunk-PANYJULW.mjs";import{a as q}from"./chunk-FGTQT7Q5.mjs";import{b as E,d as _,e as R,f as B}from"./chunk-GQI3HWOB.mjs";import{b as f,d as y,e as O}from"./chunk-6F4ACCCZ.mjs";import{a as k}from"./chunk-Y5RQOXZH.mjs";import{b as v}from"./chunk-X7QBDRQR.mjs";import{a as K}from"./chunk-AH44UPM4.mjs";import{a as h}from"./chunk-KVJ2KGMW.mjs";import{a as x}from"./chunk-OWP2MKTX.mjs";import{a as C,c as N}from"./chunk-RCYWJZR4.mjs";import{a as w,c as T}from"./chunk-5HZKDT5C.mjs";import{b as A}from"./chunk-UR5E2UDO.mjs";import{a as W}from"./chunk-5IVRKK5V.mjs";import{b as $}from"./chunk-NL72WE3E.mjs";import{c as D,d as U,g as G,h as b}from"./chunk-EOC4UI5B.mjs";import{e as I}from"./chunk-LV33NV4J.mjs";import{sha3_256 as an}from"@noble/hashes/sha3";async function Un(n){if(F(n))return nn(n);let{moduleAddress:e,moduleName:t,functionName:o}=M(n.function),r=await K(async()=>Y(e,t,o,n.aptosConfig),`entry-function-${n.aptosConfig.network}-${e}-${t}-${o}`,1e3*60*5)();return on(n,r)}function on(n,e){if(F(n))return nn(n);let{moduleAddress:t,moduleName:o,functionName:r}=M(n.function),a=V(n.typeArguments);if(a.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${a.length}`);let i=n.functionArguments.map((s,d)=>Z(n.function,e,s,d,a));if(i.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${o}::${r}', expected ${e.parameters.length} but got ${i.length}`);let c=z.build(`${t}::${o}`,r,a,i);if("multisigAddress"in n){let s=A.from(n.multisigAddress);return new X(new J(s,new Q(c)))}return new H(c)}function nn(n){return new L(new j($.fromHexInput(n.bytecode).toUint8Array(),n.typeArguments??[],n.functionArguments))}async function sn(n){let{aptosConfig:e,sender:t,payload:o,options:r}=n,a=r?.accountSequenceNumber!==void 0?Promise.resolve({sequence_number:r.accountSequenceNumber}):k({aptosConfig:e,accountAddress:t}),i=I[e.network]?Promise.resolve({chain_id:I[e.network]}):W({aptosConfig:e}),c=r?.gasUnitPrice?Promise.resolve({gas_estimate:r.gasUnitPrice}):v({aptosConfig:e}),[{sequence_number:s},{chain_id:d},{gas_estimate:p}]=await Promise.all([a,i,c]),{maxGasAmount:S,gasUnitPrice:en,expireTimestamp:rn}={maxGasAmount:r?.maxGasAmount?BigInt(r.maxGasAmount):BigInt(D),gasUnitPrice:BigInt(p),expireTimestamp:BigInt(Math.floor(Date.now()/1e3)+U),...r};return new l(A.from(t),BigInt(s),o,BigInt(S),BigInt(en),BigInt(rn),new q(d))}async function Gn(n){let{aptosConfig:e,sender:t,payload:o,options:r}=n,a=await sn({aptosConfig:e,sender:t,payload:o,options:r});if("secondarySignerAddresses"in n){let i=n.secondarySignerAddresses?.map(c=>A.from(c))??[];return{rawTransaction:a,secondarySignerAddresses:i,feePayerAddress:n.feePayerAddress?A.from(n.feePayerAddress):void 0}}return{rawTransaction:a,feePayerAddress:n.feePayerAddress?A.from(n.feePayerAddress):void 0}}function $n(n){let{signerPublicKey:e,transaction:t,secondarySignersPublicKeys:o,feePayerPublicKey:r}=n,a=P(e);if(t.feePayerAddress){let c=new m(t.rawTransaction,t.secondarySignerAddresses??[],t.feePayerAddress),s=[];o&&(s=o.map(S=>P(S)));let d=P(r),p=new R(a,t.secondarySignerAddresses??[],s,{address:t.feePayerAddress,authenticator:d});return new u(c.raw_txn,p).bcsToBytes()}if(t.secondarySignerAddresses){let c=new g(t.rawTransaction,t.secondarySignerAddresses),s=[];s=o.map(p=>P(p));let d=new _(a,t.secondarySignerAddresses,s);return new u(c.raw_txn,d).bcsToBytes()}let i;if(a instanceof f)i=new E(a.public_key,a.signature);else if(a instanceof y)i=new B(a);else throw new Error("Invalid public key");return new u(t.rawTransaction,i).bcsToBytes()}function P(n){if(n instanceof x){if(n.publicKey instanceof w)return new y(n,new h(new T(new Uint8Array(64))));if(n.publicKey instanceof C)return new y(n,new h(new N(new Uint8Array(64))))}return new f(new w(n.toUint8Array()),new T(new Uint8Array(64)))}function Cn(n){let{signer:e,transaction:t}=n,o=un(t),r=e.sign(o);switch(e.signingScheme){case 0:return new f(new w(e.publicKey.toUint8Array()),new T(r.toUint8Array()));case 2:if(!x.isPublicKey(e.publicKey))throw new Error(`Cannot sign transaction, public key does not match ${e.signingScheme}`);return new y(e.publicKey,new h(r));default:throw new Error(`Cannot sign transaction, signing scheme ${e.signingScheme} not supported`)}}function Nn(n){let{transaction:e,senderAuthenticator:t,feePayerAuthenticator:o,additionalSignersAuthenticators:r}=n,a=tn(e);if((o||r)&&(a instanceof g||a instanceof m))return cn(a,t,o,r);if(t instanceof f&&a instanceof l){let i=new E(t.public_key,t.signature);return new u(a,i).bcsToBytes()}if((t instanceof y||t instanceof O)&&a instanceof l){let i=new B(t);return new u(a,i).bcsToBytes()}throw new Error(`Cannot generate a signed transaction, ${t} is not a supported account authentication scheme`)}function tn(n){return n.feePayerAddress?new m(n.rawTransaction,n.secondarySignerAddresses??[],n.feePayerAddress):n.secondarySignerAddresses?new g(n.rawTransaction,n.secondarySignerAddresses):n.rawTransaction}function cn(n,e,t,o){if(n instanceof m){if(!t)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");let r=new R(e,n.secondary_signer_addresses,o??[],{address:n.fee_payer_address,authenticator:t});return new u(n.raw_txn,r).bcsToBytes()}if(n instanceof g){if(!o)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");let r=new _(e,n.secondary_signer_addresses,o??[]);return new u(n.raw_txn,r).bcsToBytes()}throw new Error(`Cannot prepare multi signers transaction to submission, ${typeof n} transaction is not supported`)}function un(n){let e=tn(n),t=an.create();if(e instanceof l)t.update(G);else if(e instanceof g)t.update(b);else if(e instanceof m)t.update(b);else throw new Error(`Unknown transaction type to sign on: ${e}`);let o=t.digest(),r=e.bcsToBytes(),a=new Uint8Array(o.length+r.length);return a.set(o),a.set(r,o.length),a}export{Un as a,on as b,sn as c,Gn as d,$n as e,P as f,Cn as g,Nn as h,tn as i,cn as j,un as k};
//# sourceMappingURL=chunk-MNFGMNYS.mjs.map